<div *ngIf="event" class="details-event-container">

  <div class="details-header">
    <i class="fas fa-arrow-left icon-style" (click)="goBack()"></i>
    <h1>{{ event.name }}</h1>
  </div>

  <div class="container-event-info-and-images">
    <div *ngIf="event.images.length > 1" id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <div class="image-group">
            <img *ngIf="event.images[0]" [src]="event.images[0]" class="d-block" alt="Imagen 1">
            <img *ngIf="event.images[1]" [src]="event.images[1]" class="d-block" alt="Imagen 2">
            <img *ngIf="event.images[2]" [src]="event.images[2]" class="d-block" alt="Imagen 3">
          </div>

          <div class="see-all-photos" (click)="openPhotosModal()">
            Ver {{ event.images.length }} fotos
          </div>

          <div class="photos-modal" id="photosModal">
            <div class="modal-content">
              <button class="close-modal" (click)="closePhotosModal()">‚úñ</button>
              <h2>Fotos de {{ event.name }}</h2>
              <div class="photos-grid">
                <img *ngFor="let img of event.images" [src]="img" alt="Image of {{ event.name }}">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="event.images.length === 1" class="banner-event">
      <img [src]="event.images[0]" alt="Imagen de {{ event.name }}">
    </div>

    <div class="container-info-right">
      <div class="event-map">
        <div id="google-map">
          <app-map-display2></app-map-display2>
        </div>
      </div>
      
      <div class="info-corta">
        <p>{{ event.date | date:'shortTime' }} ({{ event.date | date:'shortTimezone' }})</p>
        <p>{{ event.willAttend }} asistentes üë§</p>
        <p>\${{ event.price }}</p>
        <p>{{ event.address }}</p>
        <div class="types-stars">
          <div class="star-rating">
            <div class="star"></div>
            <div class="star"></div>
            <div class="star"></div>
            <div class="star"></div>
            <div class="star"></div>
          </div>
        </div>
        <div class="tags">
          <button>Etiqueta 1</button>
          <button>Etiqueta 2</button>
          <button>Etiqueta Num 3</button>
        </div>
        <p class="description">
          {{ event.description }}
        </p>
  
        <div class="address">
          <h5>Direccion:</h5>
          <p>{{ event.address }}</p>
        </div>
      </div>
      <div class="button-group">
        <button class="btn btn-primary btn-confirm">Confirmar Asistencia</button>
      </div>
      <div class="button-group">
        <!-- Bot√≥n para abrir la modal de actualizaci√≥n -->
        <button (click)="openUpdateModal()" class="btn btn-primary">Actualizar Lugar</button>
    
        <!-- Bot√≥n para eliminar el lugar -->
        <button (click)="openDeleteModal()" class="btn btn-danger">Eliminar Lugar</button>
      </div>

    </div>
    <!-- Modal de eliminaci√≥n -->
      <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminaci√≥n</h5>
              <button type="button" class="btn-close btn-delete" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              ¬øEst√°s seguro de que deseas eliminar este lugar?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-danger" (click)="deleteEvent()">Eliminar</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modal de actualizaci√≥n -->
      <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="updateModalLabel">Actualizar Lugar</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3" [ngClass]="{'invalid': !nameValid && event.name !== ''}">
                  <label for="eventName" class="form-label">Nombre del Lugar</label>
                  <input type="text" class="form-control" id="eventName" [(ngModel)]="event.name" name="name" maxlength="50" required>
                  <small *ngIf="!nameValid && event.name !== ''" class="error-text">El nombre debe comenzar con una letra, contener al menos una letra y no m√°s de 50 caracteres.</small>
                </div>
                <div class="mb-3" [ngClass]="{'invalid': !descriptionValid && event.description !== ''}">
                  <label for="eventDescription" class="form-label">Descripci√≥n</label>
                  <textarea class="form-control" id="eventDescription" [(ngModel)]="event.description" name="description" maxlength="250" required></textarea>
                  <small *ngIf="!descriptionValid && event.description !== ''" class="error-text">La descripci√≥n no puede tener m√°s de 250 caracteres.</small>
                </div>
                <div class="mb-3" [ngClass]="{'invalid': !addressValid && event.address !== ''}">
                  <label for="eventAddress" class="form-label">Direcci√≥n</label>
                  <input type="text" class="form-control" id="eventAddress" [(ngModel)]="event.address" name="address" required>
                  <small *ngIf="!addressValid && event.address !== ''" class="error-text">La direcci√≥n no puede estar vac√≠a.</small>
                </div>
                <div class="mb-3">
                  <label for="file-input" class="form-label">Subir Nuevas Im√°genes</label>
                  <input type="file" class="form-control" id="file-input" (change)="onFileSelected($event)" multiple>
                  <ng-container *ngIf="event?.images?.length">
                    <div class="image-container">
                      <div *ngFor="let img of event.images.slice(0, 40)">
                        <img [src]="img" alt="Imagen existente" class="existing-image-preview">
                      </div>
                    </div>
                  </ng-container>
                  <small *ngIf="!imageSelected" class="error-text">Por favor, selecciona al menos una imagen.</small>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary-edit" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary-edit" (click)="updateEvent()">Actualizar</button>
            </div>
          </div>
        </div>
      </div>
  </div>
  <!-- Modal de eliminaci√≥n -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminaci√≥n</h5>
          <button type="button" class="btn-close btn-delete" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ¬øEst√°s seguro de que deseas eliminar este lugar?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" (click)="deleteEvent()">Eliminar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal de actualizaci√≥n -->
  <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">Actualizar Lugar</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3" [ngClass]="{'invalid': !nameValid && event.name !== ''}">
              <label for="eventName" class="form-label">Nombre del Lugar</label>
              <input type="text" class="form-control" id="eventName" [(ngModel)]="event.name" name="name" maxlength="50" required>
              <small *ngIf="!nameValid && event.name !== ''" class="error-text">El nombre debe comenzar con una letra, contener al menos una letra y no m√°s de 50 caracteres.</small>
            </div>
            <div class="mb-3" [ngClass]="{'invalid': !descriptionValid && event.description !== ''}">
              <label for="eventDescription" class="form-label">Descripci√≥n</label>
              <textarea class="form-control" id="eventDescription" [(ngModel)]="event.description" name="description" maxlength="250" required></textarea>
              <small *ngIf="!descriptionValid && event.description !== ''" class="error-text">La descripci√≥n no puede tener m√°s de 250 caracteres.</small>
            </div>
            <div class="mb-3" [ngClass]="{'invalid': !addressValid && event.address !== ''}">
              <label for="eventAddress" class="form-label">Direcci√≥n</label>
              <input type="text" class="form-control" id="eventAddress" [(ngModel)]="event.address" name="address" required>
              <small *ngIf="!addressValid && event.address !== ''" class="error-text">La direcci√≥n no puede estar vac√≠a.</small>
            </div>
            <div class="mb-3">
              <label for="file-input" class="form-label">Subir Nuevas Im√°genes</label>
              <input type="file" class="form-control" id="file-input" (change)="onFileSelected($event)" multiple>
              <ng-container *ngIf="event?.images?.length">
                <div class="image-container">
                  <div *ngFor="let img of event.images.slice(0, 40)">
                    <img [src]="img" alt="Imagen existente" class="existing-image-preview">
                  </div>
                </div>
              </ng-container>
              <small *ngIf="!imageSelected" class="error-text">Por favor, selecciona al menos una imagen.</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-edit" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary-edit" (click)="updateEvent()">Actualizar</button>
        </div>
      </div>
    </div>
  </div>
</div>
